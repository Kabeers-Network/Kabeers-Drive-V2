<?php
gc_enable();
include "server/dbConnect.php";
include 'config.php';
session_start();
if(!isset($_SESSION['username']) && !isset($_SESSION['id']) ){
    header("Location:login.php");
}
if (isset($_GET['msg'])){
    $message = strip_tags(urldecode($_GET['msg']));
    $message = '<div class="message my-2 rounded alert alert-secondary w-100" role="alert">'.$message.'</div><script>function f(){$(".message").slideUp();var myNewURL = "id='.$_GET['id'].'";window.history.pushState("", "", "?" + myNewURL );}window.setTimeout(f, 50000);</script>';}else{$message='';
}
if (!isset($_GET['id'])){
    header("Location:index.php?msg=Error");
}else{
$user_check_query = "SELECT * FROM folders WHERE uniqueId='".$_GET['id']."' LIMIT 1";
$result = mysqli_query($db, $user_check_query);
$user = mysqli_fetch_assoc($result);

if ($user) {
    if ($user['uniqueId'] != $_GET['id']) {
        header("Location:index.php?msg=Error");
    }
}else{header("Location:index.php?msg=Folder+Not+Found");}
    $FolderId = $_GET['id'];
}
$query = "SELECT `name` FROM `folders` WHERE parent = '".$_SESSION['id']."'; ";
$result = mysqli_query($db, $query);
$result = mysqli_fetch_assoc($result);
echo '<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, "><title>'.$user['name'].' - '.constant('APP_NAME').'</title><link rel=stylesheet href=css/bootstrap_matrial_design.css><link rel="stylesheet" href="css/materialDesign.css"><link rel=stylesheet href=css/bootstrap_matrial_design.css><link href=https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.css rel=stylesheet><script src=js/jquery.min.js></script><!-- Lightbox--><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" /><script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><!-- Lightbox--><!-- Drag Js--><script src="https://thibaultjanbeyer.github.io/DragSelect/ds.min.js"></script><!-- Lightbox--><script src=js/propper.js></script><script src=js/bootstrap_matrial_design.js></script><link rel="stylesheet" href="css/folder.css"><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><script>$(document).ready(function() { $("body").bootstrapMaterialDesign(); });</script><div id="uploadModal" class="modal fade" role="dialog" > <div class="modal-dialog modal-dialog-centered" > <!-- Modal content--> <div class="modal-content"> <div class="modal-body"> <iframe src="folder-upload.php?id='.$_GET['id'].'" frameborder="0" style="width:100%;height:70vh;resize:vertical;overflow:auto;min-height:50vh"></iframe> </div> </div> </div></div><style>main{z-index: 1}</style> <div class="modal fade" id="MakeFolderModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true"><div class="modal-dialog modal-dialog-centered" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="exampleModalLongTitle">Make New Folder</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body"><div class="form-inline ml-auto" style="margin-top:0"><div class="md-form my-0"><form action="server/folder-server.php" method="get" target="MakeFolderIframe"><input type="text" hidden name="id" value="'.$_GET['id'].'"><input id="newFolder" style="font-size:15px;opacity:70%;width:100%" name="makeDir" class="form-control" type="text" placeholder="Enter Folder Name" aria-label="Search"></div></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button><button id="newFolderBtn" type="submit" data-toggle="tooltip" data-placement="bottom" title="Make New Folder" style="font-size:15px;opacity:70%" class="btn btn-outline-white btn-md my-0 ml-sm-2">Create</button></form></div></div></div></div><div class="bmd-layout-canvas"><div class="bmd-layout-container bmd-drawer-f-l bmd-drawer-overlay"><header class="bmd-layout-header"><div id="navbar-search-flood" class="main_search_nav_wrapper navbar-search-flood navbar navbar-light bg-faded" style="background-color:#D6D7D9;box-shadow:none"><a data-toggle="drawer" data-target="#dw-p1" aria-expanded="false"><i class="material-icons" aria-hidden="true">menu</i></a><ul class="nav navbar-nav mr-auto ml-2 text-left" style="width:35vw"><li data-toggle="drawer" data-target="#dw-p1" aria-expanded="false" class="navbar-brand text-dark text-truncate" style="overflow:hidden;color:#212529;width:100%">'.$user['name'].'</li></ul><button class="mdc-icon-button material-icons mdc-top-app-bar__action-item--unbounded" onclick="window.history.back()" aria-label="Download">arrow_back</button><button class="mdc-icon-button material-icons mdc-top-app-bar__action-item--unbounded" onclick="window.location.reload()" aria-label="Download">refresh</button><button class="mdc-icon-button text-dark search_icon_button material-icons mdc-top-app-bar__action-item--unbounded" onclick=window.location.href="search/?query=&scope=1&folder='.$FolderId.'"  aria-label="Download">search</button></div></header><div id="dw-p1" class="bmd-layout-drawer bg-faded" aria-expanded="false" aria-hidden="true"><header style="background-color:#E6E6E6;text-overflow:ellipsis;overflow:hidden"><a class="navbar-brand"><img src="user-AccountImages/'.$_SESSION["image"].'" style="border-radius:30px; margin-top:-3px;margin-right:.25em;width:1.5em;height:auto;opacity:90%">'.$_SESSION['username'].'</a></header><ul class="mdc-list list-group"><a class="list-group-item" href="index.php"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">home</i>Home</a><a class="list-group-item" data-toggle="modal" data-target="#uploadModal"href="#folder-upload.php?id='.$_GET['id'].'"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">backup</i>Upload</a><a class="list-group-item" href="folder-editor.php?id='.$_GET['id'].'"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">code</i>Text Editor</a><a class="list-group-item" href="download.php"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">get_app</i>Download URL</a><hr><a class="list-group-item text-primary" data-toggle="modal" data-target="#MakeFolderModal"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">create_new_folder</i>New Folder</a><hr><a class="list-group-item" href="settings.php"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">settings</i>Settings</a><div class="list-group-item TotalFilesCount"></div></ul></div><iframe name="MakeFolderIframe" class="d-none"></iframe><style>*{margin:0;padding:0;box-sizing:border-box}</style> <main class="bmd-layout-content" id="bmd-layout-content"> <div class=container  style=margin-top:1em><div class="row mainContainer" id="mainContainer">'.$message.'';
gc_collect_cycles();

$count = 0;
$random_number_array = range(0, 20);
shuffle($random_number_array );
$random_number_array = array_slice($random_number_array ,0,10);
$adsRandom = $random_number_array;

$query = "SELECT `name`, `uniqueId`, `shared` FROM `folders` WHERE owner = '".$_SESSION['username']."' AND parent = '".$_GET['id']."' AND myDrive=0; ";
$result = mysqli_query($db, $query);
$user = mysqli_fetch_assoc($result);
gc_collect_cycles();
if ($user) {
    echo '<div class="col-md-12 foldertext"><span class="demo-card__title mdc-typography mdc-typography--headline6">Folders</span><hr style="border-color: transparent"></div>';
   $result = mysqli_query($db, $query);
    while ($row = mysqli_fetch_row($result)) {
    if($row[2] == '1'){$shareLink = '<a class="mdc-button mdc-card__action text-primary" href="server/folder-server.php?stopShareDir='.$row[1].'"><i class="material-icons">link_off</i></a>';}else{$shareLink = '<a class="mdc-button mdc-card__action text-primary" href="server/folder-server.php?shareDir='.$row[1].'"><i class="material-icons">link</i></a>';}
    gc_collect_cycles();
    echo '<div class="col-md-6 col-xl-4 col-xs-12 col-sm-6 folder" oncontextmenu=folderContextMenuBuilder(\'server/folder-server.php?deleteDir='.$row[1].'\',\'folder.php?id='.$row[1].'\',\'server/folder-server.php?shareDir='.$row[1].'\')><div class=" px-1 mdc-card mdc-card--outlined demo-card mt-1 mb-2" style="width: 100%;margin-bottom: 1em"> <div class="mdc-card__primary-action demo-card__primary-action" tabindex="0"> <div class="demo-card__primary"> <a href="folder.php?id=' . $row[1] . '"><h2 class="demo-card__title mdc-typography mdc-typography--headline6 text-truncate" style="color: black"><i class="material-icons mdc-list-item__graphic mr-2">folder</i>' . $row[0] . ' </h2></a> </div> </div> <div class="mdc-card__actions"> <div class="mdc-card__action-buttons text-primary"> <a class="mdc-button mdc-card__action text-primary" href="folder.php?id=' . $row[1] . '"><i class="material-icons">open_in_new</i></a> <a class="mdc-button mdc-card__action text-primary" onclick="this.parentNode.parentNode.parentNode.parentNode.hidden=true" href="server/folder-server.php?deleteDir='.$row[1].'" target="delIframe"><i class="material-icons">delete</i></a> '.$shareLink.' </div> </div></div></div>';
    }
}
gc_collect_cycles();
       $query1 = "SELECT `name`,`uniqueId`, `address`,`shared`, `mimeType` FROM `files` WHERE owner ='" . $_SESSION['username'] . "' AND parent='" . $FolderId . "' ;";
        $result1 = mysqli_query($db, $query1);
        gc_collect_cycles();
        if ($result1) {
        echo '<div class="col-md-12 filetext" style="margin-bottom:-3em"><span class="demo-card__title mdc-typography mdc-typography--headline6 filestext">Files</span><hr style="border-color: transparent"></div>';
        while ($row = mysqli_fetch_row($result1)) {if ($row[3] == '1') {$sharebox = 'checked';$shareIcon = '';} else {$sharebox = null;$shareIcon = '';}
        $file = $row;
        if (in_array($row[4],array('image/png', 'image/jpg', 'image/jpeg', 'image/gif'))) {
            echo '<div class="col-md-6 col-xl-3 col-xs-12 col-sm-6 file minusTop" data-id="'.$row[1].'"  id="file" oncontextmenu="fileContextMenuBuilder(\'server/files-server.php?del=1&id='.$row[1].'\',\'uViewFile.php?id='.$row[1].'\',\'server/downloaders/download-file.php?id='.$row[1].'\', \''.$row[1].'\',\''.$sharebox.'\', \''.$row[3].'\' )"><div class="mdc-card mdc-card--outlined demo-card" style="width: 100%;margin-bottom: 0em;"> <div class="mdc-card__primary-action demo-card__primary-action" tabindex="0"><a data-fancybox="file" href="server/viewers/imageViewer.php?id='.$row[1].'" data-caption="'.$row[0].'" style="text-decoration: none !important" class="demo-card__primary text-decoration-none"> <div class="mdc-card__media bg-light px-0 py-0 demo-card__media d-flex align-items-center justify-content-center"><img onerror=this.src="user-files/'.$row[2].'"  src="'.constant('SITE_URL').'/server/thumbnail/?quality=10&url='.constant('SITE_URL').'/user-files/'.$row[2].'" style=" object-fit: fill;width:auto;height:10rem;margin-top:-1rem"></div><h2 class="text-truncate demo-card__title mdc-typography mdc-typography--headline6 text-dark mt-2 pl-2">'.$shareIcon.$row[0].'</h2></a>  </div> <div class="mdc-card__actions"> <div class="mdc-card__action-buttons"> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button mx-0 px-0" href="uViewFile.php?id='.$row[1].'"> <i class="material-icons">open_in_new</i></a> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button" href="server/files-server.php?del=1&id='.$row[1].'&result=0" target="delIframe" onclick="this.parentNode.parentNode.parentNode.parentNode.hidden=true"> <i class="material-icons">delete</i></a> <a class="text-primary" href="server/downloaders/download-file.php?id='.$row[1].'" target="delIframe" download> <i class="material-icons">get_app</i></a><div class="float-right px-0 mx-0 d-block"> <div class="dropdown"> <button class="text-primary mdc-button mdc-card__action mdc-card__action--button" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="material-icons">more_vert</i> <div class="ripple-container"></div></button> <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"> <form action="server/files-server.php?result=0" target="shareIframe" method="get" class="px-2"> <input type="text" hidden name="share" value="'.$row[1].'"> <div class="radio"> <label> <input type="checkbox" onchange="this.form.submit()" name="ShareN" value="'.$row[3].'" '.$shareBox.'> Link Sharing </label> </div> </form> <hr><button class="dropdown-item" onclick="renameModal(\''.$row[1].'\')"> RENAME</button></div> </div> </div> </div> </div></div></div>';gc_collect_cycles();
        }
        else if (in_array($row[4], array('video/ogg', 'video/mp4', 'video/m4a', 'video/3gpp', 'video/quicktime', 'video/x-msvideo', 'video/x-ms-wmv'))) {
            echo '<div class="col-md-6 col-xl-3 col-xs-12 col-sm-6 file minusTop" data-id="'.$row[1].'"  id="file" oncontextmenu="fileContextMenuBuilder(\'server/files-server.php?del=1&id='.$row[1].'\',\'uViewFile.php?id='.$row[1].'\',\'server/downloaders/download-file.php?id='.$row[1].'\', \''.$row[1].'\',\''.$sharebox.'\', \''.$row[3].'\')"><div class="mdc-card mdc-card--outlined demo-card" style="width: 100%;margin-bottom: 0em;"> <div class="mdc-card__primary-action demo-card__primary-action" tabindex="0"><a data-fancybox="file" data-type="video" data-small-btn="true" href="user-files/'.$row[2].'" data-caption="'.$row[0].'" style="text-decoration: none !important" class="demo-card__primary text-decoration-none"> <div class="mdc-card__media bg-light px-0 py-0 demo-card__media d-flex align-items-center justify-content-center" style="height:10rem"> <div class="embed-responsive embed-responsive-16by9"> <i class="material-icons embed-responsive-item text-center" style="  object-fit: fill;width:auto;height:15rem;margin-top:0;font-size:8rem;text-align:center;margin-left:25.5%;margin-top:5%">movie</i></div></div><h2 class="pl-2 text-truncate demo-card__title mdc-typography mdc-typography--headline6  text-dark mt-2">'.$shareIcon.$row[0].'</h2></a>  </div> <div class="mdc-card__actions"> <div class="mdc-card__action-buttons"> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button mx-0 px-0" href="uViewFile.php?id='.$row[1].'"> <i class="material-icons">open_in_new</i></a> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button" href="server/files-server.php?del=1&id='.$row[1].'&result=0" target="delIframe" onclick="this.parentNode.parentNode.parentNode.parentNode.hidden=true"> <i class="material-icons">delete</i></a> <a class="text-primary" href="server/downloaders/download-file.php?id='.$row[1].'" target="delIframe" download> <i class="material-icons">get_app</i></a><div class="float-right px-0 mx-0"> <div class="dropdown"> <button class="text-primary mdc-button mdc-card__action mdc-card__action--button" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="material-icons">more_vert</i> <div class="ripple-container"></div></button> <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">  <form action="server/files-server.php?result=0" target="shareIframe" method="get" class="px-2"> <input type="text" hidden name="share" value="'.$row[1].'"> <div class="radio"> <label> <input type="checkbox" onchange="this.form.submit()" name="ShareN" value="'.$row[3].'" '.$shareBox.'> Link Sharing </label> </div> </form>  <hr><button class="dropdown-item" onclick="renameModal(\''.$row[1].'\')"> RENAME</button></div></div> </div> </div> </div></div></div>';gc_collect_cycles();
        }
        else if (in_array($row[4], ['text/css', 'text/x-php', 'text/html', 'text/plain', 'application/xml', 'text/javascript', 'text/java', 'image/svg+xml'])) {
            echo '<div class="col-md-6 col-xl-3 col-xs-12 col-sm-6 file minusTop" data-id="'.$row[1].'"  id="file" oncontextmenu="fileContextMenuBuilder(\'server/files-server.php?del=1&id='.$row[1].'\',\'uViewFile.php?id='.$row[1].'\',\'server/downloaders/download-file.php?id='.$row[1].'\', \''.$row[1].'\',\''.$sharebox.'\', \''.$row[3].'\')"><div class="mdc-card mdc-card--outlined demo-card" style="width: 100%;margin-bottom: 0em;"> <div class="mdc-card__primary-action demo-card__primary-action" tabindex="0"><a data-fancybox="file" data-type="iframe" href="uViewFile.php?id='.$row[1].'" data-caption="'.$row[0].'"  style="text-decoration: none !important" class="demo-card__primary text-decoration-none"> <div class="mdc-card__media bg-light px-0 py-0 demo-card__media" style="height:10rem"> <div class="mdc-card__media bg-light demo-card__media d-flex align-items-center justify-content-center" style="height:10rem"> <div class="embed-responsive embed-responsive-16by9"> <i class="material-icons embed-responsive-item text-center" style=" object-fit: fill;width:auto;height:15rem;margin-top:0;font-size:8rem;text-align:center;margin-left:22.5%;margin-top:2%">code</i></div></div></div><h2 class="pl-2 text-truncate demo-card__title mdc-typography mdc-typography--headline6  text-dark mt-2">'.$shareIcon.$row[0].'</h2></a>  </div> <div class="mdc-card__actions"> <div class="mdc-card__action-buttons"> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button mx-0 px-0" href="uViewFile.php?id='.$row[1].'"> <i class="material-icons">open_in_new</i></a> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button" href="server/files-server.php?del=1&id='.$row[1].'&result=0" target="delIframe" onclick="this.parentNode.parentNode.parentNode.parentNode.hidden=true"> <i class="material-icons">delete</i></a> <a class="text-primary" href="server/downloaders/download-file.php?id='.$row[1].'" target="delIframe" download> <i class="material-icons">get_app</i></a><div class="float-right px-0 mx-0"> <div class="dropdown"> <button class="text-primary mdc-button mdc-card__action mdc-card__action--button" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="material-icons">more_vert</i> <div class="ripple-container"></div></button> <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">  <form action="server/files-server.php?result=0" target="shareIframe" method="get" class="px-2"> <input type="text" hidden name="share" value="'.$row[1].'"> <div class="radio"> <label> <input type="checkbox" onchange="this.form.submit()" name="ShareN" value="'.$row[3].'" '.$shareBox.'> Link Sharing </label> </div> </form>  <hr><button class="dropdown-item" onclick="renameModal(\''.$row[1].'\')"> RENAME</button></div> </div> </div> </div> </div></div></div>';gc_collect_cycles();
        }
        else if (in_array($row[4], array('application/pdf', 'application/vnd.ms-powerpoint', 'application/vnd.openxmlformats-officedocument.presentationml.presentation', 'application/rtf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'))) {
            echo '<div class="col-md-6 col-xl-3 col-xs-12 col-sm-6 file minusTop" data-id="'.$row[1].'"  id="file" oncontextmenu="fileContextMenuBuilder(\'server/files-server.php?del=1&id='.$row[1].'\',\'uViewFile.php?id='.$row[1].'\',\'server/downloaders/download-file.php?id='.$row[1].'\', \''.$row[1].'\',\''.$sharebox.'\', \''.$row[3].'\')"><div class="mdc-card mdc-card--outlined demo-card" style="width: 100%;margin-bottom: 0em;"> <div class="mdc-card__primary-action demo-card__primary-action" tabindex="0"><a  data-fancybox="file" data-type="iframe" data-thumb="uViewFile.php?id='.$row[1].'" data-caption="'.$row[0].'" href="https://docs.google.com/gview?url='.constant('SITE_URL').'/user-files/'.$row[2].'&embedded=true" style="text-decoration: none !important" class="demo-card__primary text-decoration-none"> <div class="mdc-card__media bg-light px-0 py-0 demo-card__media d-flex align-items-center justify-content-center" style="height:10rem"> <div class="embed-responsive embed-responsive-16by9"> <i class="material-icons embed-responsive-item text-center" style=" object-fit: fill;width:auto;height:15rem;margin-top:3.5rem;font-size:8rem;text-align:center;margin-left:25.5%;line-height:1rem">picture_as_pdf</i></div></div><h2 class="pl-2 text-truncate demo-card__title mdc-typography mdc-typography--headline6 text-dark mt-2">'.$shareIcon.$row[0].'</h2></a>  </div> <div class="mdc-card__actions"> <div class="mdc-card__action-buttons"> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button mx-0 px-0" href="uViewFile.php?id='.$row[1].'"> <i class="material-icons">open_in_new</i></a> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button" href="server/files-server.php?del=1&id='.$row[1].'&result=0" target="delIframe" onclick="this.parentNode.parentNode.parentNode.parentNode.hidden=true"> <i class="material-icons">delete</i></a> <a class="text-primary" href="server/downloaders/download-file.php?id='.$row[1].'" target="delIframe" download> <i class="material-icons">get_app</i></a><div class="float-right px-0 mx-0"> <div class="dropdown file-dropdown"> <button class="text-primary mdc-button mdc-card__action mdc-card__action--button" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="material-icons">more_vert</i> <div class="ripple-container"></div></button> <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"> <form action="server/files-server.php?result=0" target="shareIframe" method="get" class="px-2"> <input type="text" hidden name="share" value="'.$row[1].'"> <div class="radio"> <label> <input type="checkbox" onchange="this.form.submit()" name="ShareN" value="'.$row[3].'" '.$shareBox.'> Link Sharing </label> </div> </form>  <hr><button class="dropdown-item" onclick="renameModal(\''.$row[1].'\')"> RENAME</button></div></div> </div> </div> </div></div></div>';gc_collect_cycles();
        }
        else if (in_array($row[4],array('application/x-rar-compressed', 'application/octet-stream', 'application/zip', 'application/x-zip-compressed', 'multipart/x-zip'))) {
            echo '<div class="col-md-6 col-xl-3 col-xs-12 col-sm-6 file minusTop" data-id="'.$row[1].'"  id="file" oncontextmenu="fileContextMenuBuilder(\'server/files-server.php?del=1&id='.$row[1].'\',\'uViewFile.php?id='.$row[1].'\',\'server/downloaders/download-file.php?id='.$row[1].'\', \''.$row[1].'\',\''.$sharebox.'\', \''.$row[3].'\' )"><div class="mdc-card mdc-card--outlined demo-card" style="width: 100%;margin-bottom: 0em;"> <div class="mdc-card__primary-action demo-card__primary-action" tabindex="0"><a data-fancybox="file" data-type="iframe" href="server/modal/no-preview.php?d='.$row[1].'" data-caption="'.$row[0].'" style="text-decoration: none !important" class="demo-card__primary text-decoration-none"> <div class="mdc-card__media px-0 py-0 demo-card__media d-flex align-items-center justify-content-center bg-light" style="height:10rem"><div class="embed-responsive embed-responsive-16by9 "> <i class="material-icons embed-responsive-item text-center text-primary" style=" object-fit: fill;width:auto;height:15rem;margin-top:0;font-size:8rem;text-align:center;margin-left:23%;margin-top:2.5%">archive</i></div></div><h2 class="pl-2 text-truncate demo-card__title mdc-typography mdc-typography--headline6 mt-2  text-dark">'.$shareIcon.$row[0].'</h2></a>  </div> <div class="mdc-card__actions"> <div class="mdc-card__action-buttons"> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button mx-0 px-0" href="uViewFile.php?id='.$row[1].'"> <i class="material-icons">open_in_new</i></a> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button" href="server/files-server.php?del=1&id='.$row[1].'&result=0" target="delIframe" onclick="this.parentNode.parentNode.parentNode.parentNode.hidden=true"> <i class="material-icons">delete</i></a> <a class="text-primary" href="server/downloaders/download-file.php?id='.$row[1].'" target="delIframe" download> <i class="material-icons">get_app</i></a><div class="float-right px-0 mx-0 d-block"> <div class="dropdown"> <button class="text-primary mdc-button mdc-card__action mdc-card__action--button" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="material-icons">more_vert</i> <div class="ripple-container"></div></button> <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">  <form action="server/files-server.php?result=0" target="shareIframe" method="get" class="px-2"> <input type="text" hidden name="share" value="'.$row[1].'"> <div class="radio"> <label> <input type="checkbox" onchange="this.form.submit()" name="ShareN" value="'.$row[3].'" '.$shareBox.'> Link Sharing </label> </div> </form> <hr><button class="dropdown-item" onclick="renameModal(\''.$row[1].'\')"> RENAME</button> </div></div> </div> </div> </div></div></div>';gc_collect_cycles();
        }
        else{
            echo '<div class="col-md-6 col-xl-3 col-xs-12 col-sm-6 file minusTop" data-id="'.$row[1].'"  id="file" oncontextmenu="fileContextMenuBuilder(\'server/files-server.php?del=1&id='.$row[1].'\',\'uViewFile.php?id='.$row[1].'\',\'server/downloaders/download-file.php?id='.$row[1].'\', \''.$row[1].'\',\''.$sharebox.'\', \''.$row[3].'\' )"><div class="mdc-card mdc-card--outlined demo-card" style="width: 100%;margin-bottom: 0em;"> <div class="mdc-card__primary-action demo-card__primary-action" tabindex="0"><a data-fancybox="file" data-type="iframe" href="server/modal/no-preview.php?d='.$row[1].'" data-caption="'.$row[0].'" style="text-decoration: none !important" class="demo-card__primary text-decoration-none"> <div class="mdc-card__media px-0 py-0 demo-card__media d-flex align-items-center justify-content-center bg-light" style="height:10rem"><div class="embed-responsive embed-responsive-16by9 "> <i class="material-icons embed-responsive-item text-center text-primary" style=" object-fit: fill;width:auto;height:15rem;margin-top:0;font-size:8rem;text-align:center;margin-left:23%;margin-top:2.5%">broken_image</i></div></div><h2 class="pl-2 text-truncate demo-card__title mdc-typography mdc-typography--headline6 mt-2 text-muted">'.$shareIcon.$row[0].'</h2></a>  </div> <div class="mdc-card__actions"> <div class="mdc-card__action-buttons"> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button mx-0 px-0" href="uViewFile.php?id='.$row[1].'"> <i class="material-icons">open_in_new</i></a> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button" href="server/files-server.php?del=1&id='.$row[1].'&result=0" target="delIframe" onclick="this.parentNode.parentNode.parentNode.parentNode.hidden=true"> <i class="material-icons">delete</i></a> <a class="text-primary" href="server/downloaders/download-file.php?id='.$row[1].'" target="delIframe" download> <i class="material-icons">get_app</i></a><div class="float-right px-0 mx-0 d-block"> <div class="dropdown"> <button class="text-primary mdc-button mdc-card__action mdc-card__action--button" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="material-icons">more_vert</i> <div class="ripple-container"></div></button> <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">  <form action="server/files-server.php?result=0" target="shareIframe" method="get" class="px-2"> <input type="text" hidden name="share" value="'.$row[1].'"> <div class="radio"> <label> <input type="checkbox" onchange="this.form.submit()" name="ShareN" value="'.$row[3].'" '.$shareBox.'> Link Sharing </label> </div> </form> <hr><button class="dropdown-item" onclick="renameModal(\''.$row[1].'\')"> RENAME</button> </div></div> </div> </div> </div></div></div>';gc_collect_cycles();
        }
        gc_collect_cycles();
            $count= $count+1;
            }
        }   
mysqli_close($db);gc_collect_cycles();
?>
<script>
    // CONTEXT MENU BUILDERS
function fileContextMenuBuilder(deleteLink, viewLink, downloadLink, id, sharebox, shareVal) {
        $('#menuUl').html('<a class="dropdown-item" tabindex="-1" href="'+viewLink+'" >VIEW</a><a class="dropdown-item" tabindex="-1" href="'+downloadLink+'" download target="delIframe">DOWNLOAD</a><hr><a class="dropdown-item" href="'+deleteLink+'"> DELETE</a><hr><button class="dropdown-item" onclick="renameModal(\''+id+'\')"> RENAME</button>');
        $('#menuUl').addClass("show");
}
function folderContextMenuBuilder(deleteLink, viewLink, downloadLink, id, sharebox) {
        $('#menuUl').html('<a class="dropdown-item" tabindex="-1" href="'+viewLink+'" >OPEN</a><a class="dropdown-item" tabindex="-1" href="'+downloadLink+'" >SHARE</a><hr><a class="dropdown-item" href="'+deleteLink+'"> DELETE</a>');
        $('#menuUl').addClass("show");
}
function renameModal(id){
    $('body').prepend('<div class="modal fade renameModal" id="fileRenameModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true"><div class="modal-dialog modal-dialog-centered" role="document"><div class="modal-content"><form action="server/files-server.php" method="get"><div class="modal-header"><h5 class="modal-title" id="exampleModalLongTitle">Rename File</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body"><div class="form-inline ml-auto" style="margin-top:0"><div class="md-form my-0"><input type="text" hidden name="id" value="'+id+'"><input type="text" hidden name="rename" value="true"><input  style="font-size:15px;opacity:70%;width:100%" name="name" class="form-control" type="text" placeholder="Enter File Name" aria-label="Search"></div></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button><input type="submit" data-toggle="tooltip" data-placement="bottom" title="Make New Folder" style="font-size:15px;opacity:70%" class="btn btn-outline-white btn-md my-0 ml-sm-2" value="Rename"></form></div></div></div>');
    $('.renameModal').modal();
    $('.renameModal').on('hidden', function () {
    $('.renameModal').remove();
    });
}
$("main").scroll(function(){
  $('#menuUl').hide();
})
</script><noscript> <div style="position: fixed; top: 0px; left: 0px; z-index: 3000; height: 100%; width: 100%; background-color: #FFFFFF"> <p style="margin-left: 10px">JavaScript is not enabled.</p> </div></noscript>
</div></div></main><iframe name="shareIframe" style="display: none"></iframe><iframe class="d-none" name="delIframe"></iframe><div class="inner-fabs"> <div class="fab round" id="fab4" data-tooltip="Text Editor"><a href="folder-editor.php?id=<?php echo $_GET['id'];?>" style="color:#FFF"><i class="material-icons">code</i></a></div> <div class="fab round" id="fab3" data-tooltip="Upload Files"><i class="material-icons"><a style="color:#FFF" data-toggle="modal" data-target="#uploadModal">backup</i></a></div> <!--<div class="fab round" id="fab2" data-tooltip="Send"><i class="material-icons">send</i></div>--></div><div style="z-index:99999" class="fab round" id="fab1"><i class="material-icons" id="fabIcon">add</i></div><style>.hide{display:none!important;}a{text-decoration:none!important}.round{border-radius:50%}.fab{-webkit-transition:all 300ms ease-in-out;transition:all 300ms ease-in-out;width:56px;height:56px;background-color:#0f9c8f;display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;position:fixed;right:12.5px;bottom:15px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;//cursor:pointer;color:#FFF;font-size:2em;box-shadow:0 3px 10px rgba(0,0,0,0.16),0px 3px 10px rgba(0,0,0,0.16)}.fab i{-webkit-transition:all 300ms ease-in-out;transition:all 300ms ease-in-out;will-change:transform}.inner-fabs .fab{width:40px;height:40px;right:20px;bottom:23px;font-size:1.5em;z-index:99999;will-change:bottom}.inner-fabs.show .fab:nth-child(1){bottom:80px}.inner-fabs.show .fab:nth-child(2){bottom:130px}.inner-fabs.show .fab:nth-child(3){bottom:180px}.inner-fabs.show .fab:nth-child(4){bottom:230px}.inner-fabs.show .fab:nth-child(5){bottom:280px}.inner-fabs.show .fab:nth-child(6){bottom:330px}.inner-fabs.show+.fab i{-webkit-transform:rotate(135deg);transform:rotate(135deg)}.fab:before{content:attr(data-tooltip);-webkit-transition:opacity 150ms cubic-bezier(0.4,0,1,1);transition:opacity 150ms cubic-bezier(0.4,0,1,1);position:absolute;visibility:hidden;opacity:0;box-shadow:0 1px 2px rgba(0,0,0,0.15);color:#ececec;right:50px;top:25%;background-color:rgba(70,70,70,0.9);font-size:.5em;line-height:1em;display:inline-block;text-align:center;white-space:nowrap;border-radius:2px;padding:6px 8px;max-width:200px;font-weight:bold;text-overflow:ellipsis;vertical-align:middle}.inner-fabs.show .fab:hover:before{content:attr(data-tooltip);visibility:visible;opacity:1}</style><br><br><!-- ADS  CASH ADS--><?php  if($_SESSION['plus'] != 1){/*echo '<script data-cfasync="false" type="text/javascript" src="https://www.onclicksuper.com/a/display.php?r=3243199"></script>';*/}?><div  id="menuUl" class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div><script src="js/folder.js"></script><?php if (isset($_GET['file'])){$locateId= strip_tags($_GET['file']);echo '<script>function getUrlVars(){ var vars = [], hash; var hashes = window.location.href.slice(window.location.href.indexOf("?") + 1).split("&"); for(var i = 0; i < hashes.length; i++) { hash = hashes[i].split("="); vars.push(hash[0]); vars[hash[0]] = hash[1]; } return vars;}$("main div[data-id=\''.$locateId.'\']").addClass("ds-selected");var $container = $("main");var $scrollTo = $(".file[data-id=\''.$locateId.'\']");$container.animate({scrollTop: $scrollTo.offset().top - $container.offset().top + $container.scrollTop()-20, scrollLeft: 0},1000); window.history.replaceState({}, document.title, "folder.php?id="+getUrlVars()["id"] );</script>';}gc_collect_cycles();?>