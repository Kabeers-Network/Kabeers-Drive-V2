<?php
include 'server/dbConnect.php';
include 'config.php';
session_start();
gc_enable();
gc_collect_cycles();
if (isset($_GET['logout'])){
    unset($_SESSION['id']);
    unset($_SESSION['username']);
    unset($_SESSION['image']);
    session_destroy();
}
gc_collect_cycles();
if (!isset($_SESSION['username'])||!isset($_SESSION['id'])||!isset($_SESSION['image'])){header("Location:login.php");}

if (isset($_GET['t'])){
    if($_GET['m'] == 0){$THEME = "danger"; $MESSAGE = "<strong>UnShared </strong> Link Sharing is Turned Off for this file.";}else{$MESSAGE = "<strong>Shared </strong> This File Has been Shared! Anyone with this link can view it.";$THEME = "success";}
    echo '<div class="alert alert-'.$THEME.' alert-dismissible fade show" role="alert">'.$MESSAGE.'<br><code>'.constant('SITE_URL').'/viewer.php?id='.$_GET['t'].' - UnAvailabale</code><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><script>function f(){$(".alert").slideUp();var myNewURL = "";window.history.pushState("", "", "?" + myNewURL );}window.setTimeout(f, 5000);</script>';
}
if (isset($_GET['msg'])){
    $message = strip_tags(urldecode($_GET['msg']));
    $message = '<div class="message my-2 rounded alert alert-secondary w-100" role="alert">'.$message.'</div><script>function f(){$(".message").slideUp();var myNewURL = "";window.history.pushState("", "", "?" + myNewURL );}window.setTimeout(f, 50000);</script>';}
    else{$message='';}
gc_collect_cycles();

echo '<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, "><title>'.constant('APP_NAME').' | '.$_SESSION['username'].'</title><link rel=stylesheet href=css/bootstrap_matrial_design.css><link href=https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.css rel=stylesheet><script src=js/jquery.min.js></script><!-- Lightbox--><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" /><script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><!-- Lightbox--><!-- Drag Js--><script src="https://thibaultjanbeyer.github.io/DragSelect/ds.min.js"></script><!-- Lightbox--><script src=https://unpkg.com/popper.js@1.12.6/dist/umd/popper.js integrity=sha384-fA23ZRQ3G/J53mElWqVJEGJzU0sTs+SvzG8fXVWP+kJQ1lwFAOkcUOysnlKJC33U crossorigin=anonymous></script><script src=https://unpkg.com/bootstrap-material-design@4.1.1/dist/js/bootstrap-material-design.js integrity=sha384-CauSuKpEqAFajSpkdjv3z9t8E7RlpJ1UP0lKM/+NdtSarroVKu069AlsRPKkFBz9 crossorigin=anonymous></script><link rel="stylesheet" href="css/my-drive.css"><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><style>*{margin:0;padding:0;box-sizing:border-box}body{margin:0;padding:0;box-sizing:border-box;transition:all .75s ease}</style><div id="preloader" class="px-0 mx-0" style="position:fixed;display:block;z-index:200002;width:100%;height:100%;margin-top:0!important;padding-top:0!important;background-image:linear-gradient(#F6F6F6,#F6F6F6);background-repeat:no-repeat;background-size:cover" class="container-fluid text-center"><div role="progressbar" style="z-index:999999" class="progress-bar mdc-linear-progress mdc-linear-progress--indeterminate"><div class="mdc-linear-progress__buffering-dots"></div><div class="mdc-linear-progress__buffer"></div><div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar"><span class="mdc-linear-progress__bar-inner"></span></div><div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar"><span class="mdc-linear-progress__bar-inner"></span></div></div></div><div id="uploadModal" class="modal fade" role="dialog"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-body"><iframe src="upload.php" frameborder="0" style="width:100%;height:70vh;resize:vertical;overflow:auto;min-height:50vh"></iframe></div></div></div></div><div class="modal fade" id="MakeFolderModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true"><div class="modal-dialog modal-dialog-centered" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="exampleModalLongTitle">Make New Folder</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body"><div class="form-inline ml-auto" style="margin-top:0"><div class="md-form my-0"><form action="server/files-server.php" method="get" target="MakeFolderIframe"><input id="newFolder" style="font-size:15px;opacity:70%;width:100%" name="makeDir" class="form-control" type="text" placeholder="Enter Folder Name" aria-label="Search"></div></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button><button id="newFolderBtn" type="submit" data-toggle="tooltip" data-placement="bottom" title="Make New Folder" style="font-size:15px;opacity:70%" class="btn btn-outline-white btn-md my-0 ml-sm-2">Create</button></form></div></div></div></div><div class="bmd-layout-canvas fixed-top"><div class="bmd-layout-container fixed-top bmd-drawer-f-l bmd-drawer-overlay"><header class="bmd-layout-header"><div id="navbar-search-flood" class="main_search_nav_wrapper navbar-search-flood navbar navbar-light bg-faded" style="background-color:#D6D7D9;box-shadow:none"><a data-toggle="drawer" data-target="#dw-p1" aria-expanded="false"><i class="material-icons" aria-hidden="true">menu</i></a><ul class="nav navbar-nav mr-auto ml-2 text-left"><li data-toggle="drawer" data-target="#dw-p1" aria-expanded="false" class="navbar-brand text-dark text-truncate" style="color:#212529">My Drive</li></ul><button class="mdc-icon-button material-icons mdc-top-app-bar__action-item--unbounded" onclick="window.location.reload()" aria-label="Download">refresh</button><button onclick=window.location.href="search/?query=&scope=0" class="mdc-icon-button text-dark search_icon_button material-icons mdc-top-app-bar__action-item--unbounded" aria-label="Download">search</button></div></header><div id="dw-p1" class="bmd-layout-drawer bg-faded" aria-expanded="false" aria-hidden="true"><header style="background-color:#E6E6E6;text-overflow:ellipsis;overflow:hidden"><a class="navbar-brand"><img src="user-AccountImages/'.$_SESSION["image"].'" style="border-radius:30px;margin-top:-3px;margin-right:.25em;width:1.5em;height:auto;opacity:90%">'.$_SESSION['username'].'</a></header><ul class="mdc-list list-group"><a class="list-group-item" href="index.php"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">home</i>Home</a><a class="list-group-item" data-toggle="modal" href="#" data-target="#uploadModal"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">backup</i>Upload</a><a class="list-group-item" href="editor.php"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">code</i>Text Editor</a><a class="list-group-item" href="download.php"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">get_app</i>Download URL</a><hr><a class="list-group-item text-primary" data-toggle="modal" data-target="#MakeFolderModal"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">create_new_folder</i>New Folder</a><hr><a class="list-group-item" href="settings.php"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">settings</i>Settings</a><div class="a list-group-item TotalFilesCount"></div></ul></div><covidBanner></covidBanner><style>*{margin:0;padding:0;box-sizing:border-box}</style><main class="bmd-layout-content" id="bmd-layout-content"> <div class=container  style=margin-top:1em><div class="row mainContainer" id="mainContainer">';
if(!isset($_SESSION['username']) && !isset($_SESSION['id'])){
    header("Location:login.php");
}
gc_collect_cycles();
echo $message;
$count = 0;
$random_number_array = range(0, 20);
shuffle($random_number_array );
$random_number_array = array_slice($random_number_array ,0,10);
$adsRandom = $random_number_array;
echo '<style>div.scrollmenu { background-color: #FFF; overflow: auto; white-space: nowrap; scroll-snap-type: x mandatory;}div.scrollmenu .card {scroll-snap-align: start;margin-right:1em;display: inline-block}div.scrollmenu div:hover {opacity: 100%;}a{text-decoration:none}</style>';

$query = "SELECT `name`,`uniqueId`,`address`, `mimeType` FROM `files` WHERE `owner` = '".$_SESSION['username']."' ORDER BY id DESC LIMIT 5;";
$result = mysqli_query($db, $query);
echo '<div class="container-fluid w-100 recentContainer" id =" recentContainer"><span class="demo-card__title mdc-typography mdc-typography--headline6">Recent</span><hr style="border-color: transparent"><div class="scrollmenu" style="width:100%;height: 17em; background-color: #FAFAFA;">';

    while($row = mysqli_fetch_row($result)) {
            $file =$row;
            if (in_array($file[3], ['image/png','image/jpg','image/jpeg','image/gif'])) {
                echo '<div class="card border file-card" data-id="'.$row[1].'" style="border-color:#e6e6e6;border-radius:5px;width:15rem;box-shadow:none;height:15rem"><img class="card-img-top bg-light" onerror=this.src="user-files/'.$row[2].'" src="'.constant('SITE_URL').'/server/thumbnail/?quality=10&url='.constant('SITE_URL').'/user-files/'.$row[2].'" oncontextmenu="return false" style="width:100%;height:8rem" scrolling="no" alt="Card image cap" frameborder="0" scrolling="no" seamless="1"><div class="card-body border-top" style="border-color:#e6e6e6"><a data-fancybox="recent" href="server/viewers/imageViewer.php?id='.$row[1].'" data-caption="'.$row[0].'"><h5 class="card-title text-dark" style="overflow:hidden;text-overflow:ellipsis">'.$row['0'].'</h5></a><a href="uViewFile.php?id='.$row['1'].'" class="btn btn-primary"><i class="material-icons">open_in_new</i></a><a href="server/files-server.php?del=1&id='.$row['1'].'" class="delete btn text-primary" target="delIframe" class="btn btn-primary"><i class="material-icons">delete</i></a><a class="text-primary btn" href="server/downloaders/download-file.php?id='.$row[1].'" download><i class="material-icons">get_app</i></a></div></div>';
            }
            else if (in_array($file[3], ['video/ogg','video/m4a','video/ogg','video/mov', 'video/mp4'])) {
                echo '<div class="card border file-card" data-id="'.$row[1].'" style="border-color:#e6e6e6;border-radius:5px;width:15rem;box-shadow:none;height:15rem"><div class="card-img-top bg-light embed-responsive embed-responsive-16by9" oncontextmenu="return false" style="width:100%;height:8rem" scrolling="no"><i class="material-icons text-primary embed-responsive-item text-center" style="object-fit:fill;width:auto;height:15rem;margin-top:0;font-size:7.5rem;text-align:center;margin-left:25.5%;margin-top:2.5%">movie</i></div><div class="card-body border-top" style="border-color:#e6e6e6"><a data-fancybox="recent" data-type="video" data-small-btn="true" href="user-files/'.$row[2].'" data-caption="'.$row[0].'"><h5 class="card-title text-dark" style="overflow:hidden;text-overflow:ellipsis">'.$row['0'].'</h5></a><a href="uViewFile.php?id='.$row['1'].'" class="btn btn-primary"><i class="material-icons">open_in_new</i></a><a href="server/files-server.php?del=1&id='.$row['1'].'" target="delIframe" onclick="this.parent.parent.parent.hidden=true" class="delete btn btn-primary"><i class="material-icons">delete</i></a><a class="text-primary btn" href="server/downloaders/download-file.php?id='.$row[1].'" download><i class="material-icons">get_app</i></a></div></div> ';            
            }
            else if (in_array($file[3], ['text/css','text/x-php','text/html','text/xhtml','text/plain','image/svg','image/svg+xml', 'text/javscript'])) {
                echo '<div class="card border file-card" data-id="'.$row[1].'" style="border-color:#e6e6e6;border-radius:5px;width:15rem;box-shadow:none;height:15rem"><div class="embed-responsive embed-responsive-16by9 bg-light"><i class="material-icons embed-responsive-item text-center text-primary" style="object-fit:fill;width:auto;height:15rem;margin-top:0;font-size:8rem;text-align:center;margin-left:25.5%;margin-top:2.5%">code</i></div><div class="card-body border-top" style="border-color:#e6e6e6"><a data-fancybox="recent" data-type="iframe" data-fancybox="cl-group" href="uViewFile.php?id='.$row[1].'" data-caption="'.$row[0].'"><h5 class="card-title text-dark" style="overflow:hidden;text-overflow:ellipsis">'.$row['0'].'</h5></a><a href="uViewFile.php?id='.$row['1'].'" class="btn btn-primary"><i class="material-icons">open_in_new</i></a><a href="server/files-server.php?del=1&id='.$row['1'].'" onclick="this.parent.parent.parent.hidden=true" class="delete btn btn-primary" target="delIframe"><i class="material-icons">delete</i></a><a class="text-primary btn" href="server/downloaders/download-file.php?id='.$row[1].'" download><i class="material-icons">get_app</i></a></div></div> ';            
            }
            else if (in_array($row[4], array('application/pdf', 'application/vnd.ms-powerpoint', 'application/vnd.openxmlformats-officedocument.presentationml.presentation', 'application/rtf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'))) {
                echo '<div class="card border file-card" data-id="'.$row[1].'" style="border-color:#e6e6e6;width:15rem;box-shadow:none;height:15rem"><div class="embed-responsive embed-responsive-16by9 bg-light"><i class="material-icons embed-responsive-item text-center text-primary" style="object-fit:fill;width:auto;height:15rem;margin-top:0;font-size:8rem;text-align:center;margin-left:25.5%;margin-top:2.5%">picture_as_pdf</i></div><div class="card-body border-top" style="border-color:#e6e6e6"><a data-fancybox="recent" data-type="iframe" data-fancybox="cl-group" data-thumb="uViewFile.php?id='.$row[1].'" data-caption="'.$row[0].'" href="https://docs.google.com/gview?url='.constant('SITE_URL').'/user-files/'.$row[2].'&embedded=true"><h5 class="card-title text-dark" style="overflow:hidden;text-overflow:ellipsis">'.$row['0'].'</h5></a><a href="uViewFile.php?id='.$row['1'].'" class="btn btn-primary"><i class="material-icons">open_in_new</i></a><a href="server/files-server.php?del=1&id='.$row['1'].'" target="delIframe" onclick="this.parent.parent.parent.hidden=true" class="delete btn btn-primary"><i class="material-icons">delete</i></a><a class="text-primary mdc-button mdc-card__action mdc-card__action--button" href="server/downloaders/download-file.php?id='.$row[1].'" download><i class="material-icons">get_app</i></a></div></div> ';
            }
            else{
                echo '<div class="card border file-card" data-id="'.$row[1].'" style="border-color:#e6e6e6;border-radius:5px;width:15rem;box-shadow:none;height:15rem"><div class="embed-responsive embed-responsive-16by9 bg-light"><i class="material-icons embed-responsive-item text-center text-primary" style="object-fit:fill;width:auto;height:15rem;margin-top:0;font-size:7.5rem;text-align:center;margin-left:25.5%;margin-top:2.5%">archive</i></div><div class="card-body border-top" style="border-color:#e6e6e6"><a data-fancybox="recent" data-type="iframe" data-fancybox="cl-group" href="server/modal/no-preview.php?d='.$row[1].'" data-caption="'.$row[0].'"><h5 class="card-title text-dark" style="overflow:hidden;text-overflow:ellipsis">'.$row['0'].'</h5></a><a href="uViewFile.php?id='.$row['1'].'" class="btn btn-primary"><i class="material-icons">open_in_new</i></a><a href="server/files-server.php?del=1&id='.$row['1'].'" onclick="this.parent.parent.parent.hidden=true" target="delIframe" class="btn btn-primary"><i class="material-icons">delete</i></a><a class="delete text-primary btn" href="server/downloaders/download-file.php?id='.$row[1].'" download><i class="material-icons">get_app</i></a></div></div> ';
            }
        gc_collect_cycles();
    }
echo '</div></div>';
gc_collect_cycles();
$query = "SELECT `name`, `uniqueId`, `shared` FROM `folders` WHERE owner = '".$_SESSION['username']."' AND parent = '".$_SESSION['id']."' AND myDrive=0;";
$result = mysqli_query($db, $query);
$user = mysqli_fetch_assoc($result);
if ($user) {
    echo '<div class="col-md-12 folderstext"><span class="demo-card__title mdc-typography mdc-typography--headline6">Folders</span><hr style="border-color: transparent"></div>';
    $result = mysqli_query($db, $query);
    while($row = mysqli_fetch_row($result)){
    if($row[2] == '1'){$shareLink = '<a class="mdc-button mdc-card__action text-primary" href="server/folder-server.php?stopShareDir='.$row[1].'"><i class="material-icons">link_off</i></a>';}else{$shareLink = '<a class="mdc-button mdc-card__action text-primary" href="server/folder-server.php?shareDir='.$row[1].'"><i class="material-icons">link</i></a>';}

            echo '<div class="col-md-6 col-xl-4 col-xs-12 col-sm-6 folder" oncontextmenu=folderContextMenuBuilder(\'server/folder-server.php?deleteDir='.$row[1].'\',\'folder.php?id='.$row[1].'\',\'server/folder-server.php?shareDir='.$row[1].'\')><div class="px-2 py-2 mdc-card mdc-card--outlined demo-card" style="width:100%;margin-bottom:1em"><div class="mdc-card__primary-action demo-card__primary-action" tabindex="0"><a href="folder.php?id='.$row[1].'"><div class="demo-card__primary"><h2 class="demo-card__title mdc-typography mdc-typography--headline6 text-truncate" style="color:#3C3F41!important"><i class="material-icons mdc-list-item__graphic mr-2">folder</i>'.$row[0].' </h2></div></a></div><div class="mdc-card__actions"><div class="mdc-card__action-buttons"><a target="delIframe" onclick="this.parentNode.parentNode.parentNode.parentNode.hidden=true" class="text-primary btn" href="server/folder-server.php?deleteDir='.$row[1].'"><span class="mdc-button__ripple"></span><i class="material-icons">delete</i></a><a class="text-primary btn" href="folder.php?id='.$row[1].'"><span class="mdc-button__ripple"></span><i class="material-icons">open_in_new</i></a> '.$shareLink.' </div></div></div></div>';
        }



}
gc_collect_cycles();
$query1 = "SELECT `name`,`uniqueId`, `address`,`shared`,`mimeType` FROM `files` WHERE owner ='".$_SESSION['username']."' AND parent='".$_SESSION['id']."';";
    //DELETE FROM `files` WHERE shared = '0';
    $result1 = mysqli_query($db, $query1);
echo '<div class="col-md-12 filestext"><span class="demo-card__title mdc-typography mdc-typography--headline6">Files</span><hr style="border-color: transparent"></div>';

  if ($result1){
      while($row = mysqli_fetch_row($result1)){

        $file['mimeType'] = $row[4];
        if (in_array($row[4],array('image/png', 'image/jpg', 'image/jpeg', 'image/svg+xml', 'image/gif'))) {
            echo '<div class="col-md-6 col-xl-3 col-xs-12 col-sm-6 file minusTop  file-card" data-id="'.$row[1].'"  id="file" oncontextmenu="fileContextMenuBuilder(\'server/files-server.php?del=1&id='.$row[1].'\',\'uViewFile.php?id='.$row[1].'\',\'server/downloaders/download-file.php?id='.$row[1].'\', \''.$row[1].'\',\''.$sharebox.'\', \''.$row[3].'\' )"><div class="mdc-card mdc-card--outlined demo-card" style="width: 100%;margin-bottom: 0em;"> <div class="mdc-card__primary-action demo-card__primary-action" tabindex="0"><a data-fancybox="file" href="server/viewers/imageViewer.php?id='.$row[1].'"  data-caption="'.$row[0].'" style="text-decoration: none !important" class="demo-card__primary text-decoration-none"> <div class="mdc-card__media bg-light  demo-card__media d-flex align-items-center justify-content-center"> <img src="'.constant('SITE_URL').'/server/thumbnail/?quality=10&url='.constant('SITE_URL').'/user-files/'.$row[2].'" onerror=this.src="user-files/'.$row[2].'" style=" object-fit: fill;width:auto;height:9rem;margin-top:0"></div><h2 class="text-truncate demo-card__title mdc-typography mdc-typography--headline6" style="color: black">'.$shareIcon.$row[0].'</h2></a>  </div> <div class="mdc-card__actions"> <div class="mdc-card__action-buttons"> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button mx-0 px-0" href="uViewFile.php?id='.$row[1].'"> <i class="material-icons">open_in_new</i></a> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button" href="server/files-server.php?del=1&id='.$row[1].'&result=0" target="delIframe" onclick="this.parentNode.parentNode.parentNode.parentNode.hidden=true"> <i class="material-icons">delete</i></a> <a class="text-primary" href="server/downloaders/download-file.php?id='.$row[1].'" target="delIframe" download> <i class="material-icons">get_app</i></a><div class="float-right px-0 mx-0 d-block"> <div class="dropdown"> <button class="text-primary mdc-button btn mdc-card__action mdc-card__action--button" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="material-icons">more_vert</i> <div class="ripple-container"></div></button> <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"> <form action="server/files-server.php?result=0" target="shareIframe" method="get" class="px-2"> <input type="text" hidden name="share" value="'.$row[1].'"> <div class="radio"> <label> <input type="checkbox" onchange="this.form.submit()" name="ShareN" value="'.$row[3].'" '.$shareBox.'> Link Sharing </label> </div> </form>  <hr><button class="dropdown-item" onclick="renameModal(\''.$row[1].'\')"> RENAME</button></div> </div> </div> </div> </div></div></div>';
        }
        else if (in_array($row[4], array('video/ogg', 'video/mp4', 'video/m4a', 'video/3gpp', 'video/quicktime', 'video/x-msvideo', 'video/x-ms-wmv'))) {
            echo '<div class="col-md-6 col-xl-3 col-xs-12 col-sm-6 file minusTop file-card" data-id="'.$row[1].'"  id="file" oncontextmenu="fileContextMenuBuilder(\'server/files-server.php?del=1&id='.$row[1].'\',\'uViewFile.php?id='.$row[1].'\',\'server/downloaders/download-file.php?id='.$row[1].'\', \''.$row[1].'\',\''.$sharebox.'\', \''.$row[3].'\')"><div class="mdc-card mdc-card--outlined demo-card" style="width: 100%;margin-bottom: 0em;"> <div class="mdc-card__primary-action demo-card__primary-action" tabindex="0"><a data-fancybox="file" data-type="video" data-small-btn="true" href="user-files/'.$row[2].'"  data-caption="'.$row[0].'" style="text-decoration: none !important" class="demo-card__primary text-decoration-none"> <div class="mdc-card__media bg-light demo-card__media d-flex align-items-center justify-content-center" style="height:9rem"> <div class="embed-responsive embed-responsive-16by9"> <i class="material-icons embed-responsive-item text-center" style=" object-fit: fill;width:auto;height:15rem;margin-top:0;font-size:8rem;text-align:center;margin-left:25.5%;margin-top:5%">movie</i></div></div><h2 class="text-truncate demo-card__title mdc-typography mdc-typography--headline6" style="color: black">'.$shareIcon.$row[0].'</h2></a>  </div> <div class="mdc-card__actions"> <div class="mdc-card__action-buttons"> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button mx-0 px-0" href="uViewFile.php?id='.$row[1].'"> <i class="material-icons">open_in_new</i></a> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button" href="server/files-server.php?del=1&id='.$row[1].'&result=0" target="delIframe" onclick="this.parentNode.parentNode.parentNode.parentNode.hidden=true"> <i class="material-icons">delete</i></a> <a class="text-primary" href="server/downloaders/download-file.php?id='.$row[1].'" target="delIframe" download> <i class="material-icons">get_app</i></a><div class="float-right px-0 mx-0"> <div class="dropdown"> <button class="text-primary mdc-button mdc-card__action mdc-card__action--button" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="material-icons">more_vert</i> <div class="ripple-container"></div></button> <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">  <form action="server/files-server.php?result=0" target="shareIframe" method="get" class="px-2"> <input type="text" hidden name="share" value="'.$row[1].'"> <div class="radio"> <label> <input type="checkbox" onchange="this.form.submit()" name="ShareN" value="'.$row[3].'" '.$shareBox.'> Link Sharing </label> </div> </form>  <hr><button class="dropdown-item" onclick="renameModal(\''.$row[1].'\')"> RENAME</button></div> </div> </div> </div> </div></div></div>';
        }
        else if (in_array($row[4], ['text/css' , 'text/x-php', 'text/html', 'text/plain','text/javascript'])) {
            echo '<div class="col-md-6 col-xl-3 col-xs-12 col-sm-6 file minusTop file-card" data-id="'.$row[1].'"  id="file" oncontextmenu="fileContextMenuBuilder(\'server/files-server.php?del=1&id='.$row[1].'\',\'uViewFile.php?id='.$row[1].'\',\'server/downloaders/download-file.php?id='.$row[1].'\', \''.$row[1].'\',\''.$sharebox.'\', \''.$row[3].'\')"><div class="mdc-card mdc-card--outlined demo-card" style="width: 100%;margin-bottom: 0em;"> <div class="mdc-card__primary-action demo-card__primary-action" tabindex="0"><a data-fancybox="file" data-type="iframe" data-fancybox="cl-group" href="uViewFile.php?id='.$row[1].'"  data-caption="'.$row[0].'" style="text-decoration: none !important" class="demo-card__primary text-decoration-none"> <div class="mdc-card__media bg-light demo-card__media" style="height:9rem"> <div class="embed-responsive embed-responsive-16by9"> <i class="material-icons embed-responsive-item text-center" style=" object-fit: fill;width:auto;height:15rem;margin-top:0;font-size:8rem;text-align:center;margin-left:25.5%;margin-top:5%">code</i></div></div><h2 class="text-truncate demo-card__title mdc-typography mdc-typography--headline6" style="color: black">'.$shareIcon.$row[0].'</h2></a>  </div> <div class="mdc-card__actions"> <div class="mdc-card__action-buttons"> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button mx-0 px-0" href="uViewFile.php?id='.$row[1].'"> <i class="material-icons">open_in_new</i></a> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button" href="server/files-server.php?del=1&id='.$row[1].'&result=0" target="delIframe" onclick="this.parentNode.parentNode.parentNode.parentNode.hidden=true"> <i class="material-icons">delete</i></a> <a class="text-primary" href="server/downloaders/download-file.php?id='.$row[1].'" target="delIframe" download> <i class="material-icons">get_app</i></a><div class="float-right px-0 mx-0"> <div class="dropdown"> <button class="text-primary mdc-button mdc-card__action mdc-card__action--button" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="material-icons">more_vert</i> <div class="ripple-container"></div></button> <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">  <form action="server/files-server.php?result=0" target="shareIframe" method="get" class="px-2"> <input type="text" hidden name="share" value="'.$row[1].'"> <div class="radio"> <label> <input type="checkbox" onchange="this.form.submit()" name="ShareN" value="'.$row[3].'" '.$shareBox.'> Link Sharing </label> </div> </form>  <hr><button class="dropdown-item" onclick="renameModal(\''.$row[1].'\')"> RENAME</button></div> </div> </div> </div> </div></div></div>';
        }
        else if (in_array($row[4], array('application/pdf', 'application/vnd.ms-powerpoint', 'application/vnd.openxmlformats-officedocument.presentationml.presentation', 'application/rtf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'))) {
            echo '<div class="col-md-6 col-xl-3 col-xs-12 col-sm-6 file minusTop file-card"  data-id="'.$row[1].'" id="file" oncontextmenu="fileContextMenuBuilder(\'server/files-server.php?del=1&id='.$row[1].'\',\'uViewFile.php?id='.$row[1].'\',\'server/downloaders/download-file.php?id='.$row[1].'\', \''.$row[1].'\',\''.$sharebox.'\', \''.$row[3].'\')"><div class="mdc-card mdc-card--outlined demo-card" style="width: 100%;margin-bottom: 0em;"> <div class="mdc-card__primary-action demo-card__primary-action" tabindex="0"><a data-fancybox="file" data-type="iframe" data-fancybox="cl-group" data-thumb="uViewFile.php?id='.$row[1].'"  data-caption="'.$row[0].'" href="https://docs.google.com/gview?url='.constant('SITE_URL').'/user-files/'.$row[2].'&embedded=true" style="text-decoration: none !important" class="demo-card__primary text-decoration-none"> <div class="mdc-card__media bg-light demo-card__media d-flex align-items-center justify-content-center" style="height:9rem"> <div class="embed-responsive embed-responsive-16by9"> <i class="material-icons embed-responsive-item text-center" style="  object-fit: fill;width:auto;height:15rem;margin-top:0;font-size:8rem;text-align:center;margin-left:25.5%;margin-top:5%">picture_as_pdf</i></div></div><h2 class="text-truncate demo-card__title mdc-typography mdc-typography--headline6" style="color: black">'.$shareIcon.$row[0].'</h2></a>  </div> <div class="mdc-card__actions"> <div class="mdc-card__action-buttons"> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button mx-0 px-0" href="uViewFile.php?id='.$row[1].'"> <i class="material-icons">open_in_new</i></a> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button" href="server/files-server.php?del=1&id='.$row[1].'&result=0" target="delIframe" onclick="this.parentNode.parentNode.parentNode.parentNode.hidden=true"> <i class="material-icons">delete</i></a> <a class="text-primary" href="server/downloaders/download-file.php?id='.$row[1].'" target="delIframe" download> <i class="material-icons">get_app</i></a><div class="float-right px-0 mx-0"> <div class="dropdown file-dropdown"> <button class="text-primary mdc-button mdc-card__action mdc-card__action--button" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="material-icons">more_vert</i> <div class="ripple-container"></div></button> <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"> <form action="server/files-server.php?result=0" target="shareIframe" method="get" class="px-2"> <input type="text" hidden name="share" value="'.$row[1].'"> <div class="radio"> <label> <input type="checkbox" onchange="this.form.submit()" name="ShareN" value="'.$row[3].'" '.$shareBox.'> Link Sharing </label> </div> </form>  <hr><button class="dropdown-item" onclick="renameModal(\''.$row[1].'\')"> RENAME</button></div> </div> </div> </div> </div></div></div>';
        }
        else if (in_array($row[4],array('application/x-rar-compressed', 'application/octet-stream', 'application/zip', 'application/x-zip-compressed', 'multipart/x-zip'))) {
            echo '<div class="col-md-6 col-xl-3 col-xs-12 col-sm-6 file minusTop file-card" data-id="'.$row[1].'"  id="file" oncontextmenu="fileContextMenuBuilder(\'server/files-server.php?del=1&id='.$row[1].'\',\'uViewFile.php?id='.$row[1].'\',\'server/downloaders/download-file.php?id='.$row[1].'\', \''.$row[1].'\',\''.$sharebox.'\', \''.$row[3].'\' )"><div class="mdc-card mdc-card--outlined demo-card" style="width: 100%;margin-bottom: 0em;"> <div class="mdc-card__primary-action demo-card__primary-action" tabindex="0"><a data-fancybox="file" data-type="iframe" data-fancybox="cl-group" href="server/modal/no-preview.php?d='.$row[1].'"  data-caption="'.$row[0].'"  style="text-decoration: none !important" class="demo-card__primary text-decoration-none"> <div class="mdc-card__media bg-light demo-card__media d-flex align-items-center justify-content-center" style="height:9rem"> <div class="embed-responsive embed-responsive-16by9"> <i class="material-icons embed-responsive-item text-center" style=" object-fit: fill;width:auto;height:15rem;margin-top:0;font-size:8rem;text-align:center;margin-left:25.5%;margin-top:5%">archive</i></div></div><h2 class="text-truncate demo-card__title mdc-typography mdc-typography--headline6" style="color: black">'.$shareIcon.$row[0].'</h2></a>  </div> <div class="mdc-card__actions"> <div class="mdc-card__action-buttons"> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button mx-0 px-0" href="uViewFile.php?id='.$row[1].'"> <i class="material-icons">open_in_new</i></a> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button" href="server/files-server.php?del=1&id='.$row[1].'&result=0" target="delIframe" onclick="this.parentNode.parentNode.parentNode.parentNode.hidden=true"> <i class="material-icons">delete</i></a> <a class="text-primary" href="server/downloaders/download-file.php?id='.$row[1].'" target="delIframe" download> <i class="material-icons">get_app</i></a><div class="float-right px-0 mx-0 d-block"> <div class="dropdown"> <button class="text-primary mdc-button mdc-card__action mdc-card__action--button" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="material-icons">more_vert</i> <div class="ripple-container"></div></button> <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">  <form action="server/files-server.php?result=0" target="shareIframe" method="get" class="px-2"> <input type="text" hidden name="share" value="'.$row[1].'"> <div class="radio"> <label> <input type="checkbox" onchange="this.form.submit()" name="ShareN" value="'.$row[3].'" '.$shareBox.'> Link Sharing </label> </div> </form>  <hr><button class="dropdown-item" onclick="renameModal(\''.$row[1].'\')"> RENAME</button></div> </div> </div> </div> </div></div></div>';
        }
        else{
        echo '<div class="col-md-6 col-xl-3 col-xs-12 col-sm-6 file minusTop file-card" data-id="'.$row[1].'"  id="file" oncontextmenu="fileContextMenuBuilder(\'server/files-server.php?del=1&id='.$row[1].'\',\'uViewFile.php?id='.$row[1].'\',\'server/downloaders/download-file.php?id='.$row[1].'\', \''.$row[1].'\',\''.$sharebox.'\', \''.$row[3].'\' )"><div class="mdc-card mdc-card--outlined demo-card" style="width: 100%;margin-bottom: 0em;"> <div class="mdc-card__primary-action demo-card__primary-action" tabindex="0"><a data-fancybox="file" data-type="iframe" data-fancybox="cl-group" href="server/modal/no-preview.php?d='.$row[1].'"   data-caption="'.$row[0].'" style="text-decoration: none !important" class="demo-card__primary text-decoration-none"><div class="mdc-card__media bg-light demo-card__media d-flex align-items-center justify-content-center" style="height:9rem">  <div class="embed-responsive embed-responsive-16by9"> <i class="material-icons embed-responsive-item text-center text-primary" style=" object-fit: fill;width:auto;height:15rem;margin-top:0;font-size:8rem;text-align:center;margin-left:25.5%;margin-top:5%">code</i></div></div><h2 class="text-truncate demo-card__title mdc-typography mdc-typography--headline6" style="color: black">'.$shareIcon.$row[0].'</h2></a>  </div> <div class="mdc-card__actions"> <div class="mdc-card__action-buttons"> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button mx-0 px-0" href="uViewFile.php?id='.$row[1].'"> <i class="material-icons">open_in_new</i></a> <a class="text-primary mdc-button mdc-card__action mdc-card__action--button" href="server/files-server.php?del=1&id='.$row[1].'" target="delIframe" onclick="this.parentNode.parentNode.parentNode.parentNode.hidden=true"> <i class="material-icons">delete</i></a> <a class="text-primary" href="server/downloaders/download-file.php?id='.$row[1].'" target="delIframe" download> <i class="material-icons">get_app</i></a><div class="float-right px-0 mx-0"> <div class="dropdown"> <button class="text-primary mdc-button mdc-card__action mdc-card__action--button" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="material-icons">more_vert</i> <div class="ripple-container"></div></button> <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"> <form action="server/files-server.php?result=0" target="shareIframe" method="get" class="px-2"> <input type="text" hidden name="share" value="'.$row[1].'"> <div class="radio"> <label> <input type="checkbox" onchange="this.form.submit()" name="ShareN" value="'.$row[3].'" '.$shareBox.'> Link Sharing </label> </div> </form>  <hr><button class="dropdown-item" onclick="renameModal(\''.$row[1].'\')"> RENAME</button></div> </div> </div> </div> </div></div></div>';
        }
        //if(isset($_SESSION['plus'])&&in_array($count, $adsRandom)&& $_SESSION['plus'] != 1){ echo ' <div class="col-sm-4 '.$count.' d-flex justify-content-center mb-3"><div class="mdc-card mdc-card--outlined demo-card" style="width: 100%;padding-top: 0;padding-bottom: 0;margin-bottom: 0;height:7em"><div class="mdc-card__primary-action demo-card__primary-action" tabindex="0"><div class="demo-card__primary"><iframe data-aa="1384447" src="//acceptable.a-ads.com/1384447" scrolling="no" style="border:0px; padding:0; width:100%; height:5em; overflow:hidden" allowtransparency="true"></iframe> </div> </div> <div class="mdc-card__actions" style="background-color:#8ACDC7;color:white;"> <div class="mdc-card__action-buttons" style="height:1em"> <a class="text-muted mdc-button mdc-card__action "><span class="mdc-button__ripple"></span> Ad By Kabeer\'s Network</a> <button onclick="hideAd(\''.$count.'\')" class="text-muted mdc-button mdc-card__action "><span class="mdc-button__ripple"></span> Hide Ad</button> </div> </div></div></div> '; }
        $count= $count+1;

    }

  }
gc_collect_cycles();
mysqli_close($db);
?>
<script>
    // CONTEXT MENU BUILDERS
function fileContextMenuBuilder(deleteLink, viewLink, downloadLink, id, sharebox, shareVal) {
        $('#menuUl').html('<a class="dropdown-item" tabindex="-1" href="'+viewLink+'" >VIEW</a><a class="dropdown-item" tabindex="-1" href="'+downloadLink+'" download target="delIframe">DOWNLOAD</a><hr><a class="dropdown-item" href="'+deleteLink+'"> DELETE</a><hr><button class="dropdown-item" onclick="renameModal(\''+id+'\')"> RENAME</button>');
        $('#menuUl').addClass("show");
        //<form action="server/files-server.php" target="shareIframe" method="get" class="dropdown-item"> <input type="text" hidden name="share" value="'+shareVal+'"><label> <input type="checkbox" onchange="this.form.submit()" name="ShareN" value="'+id+'" '+sharebox+'> Link Sharing </label> </div> </form>
}
function folderContextMenuBuilder(deleteLink, viewLink, downloadLink, id, sharebox) {
        $('#menuUl').html('<a class="dropdown-item" tabindex="-1" href="'+viewLink+'" >OPEN</a><a class="dropdown-item" tabindex="-1" href="'+downloadLink+'" >SHARE</a><hr><a class="dropdown-item" href="'+deleteLink+'"> DELETE</a>');
        $('#menuUl').addClass("show");
}
function renameModal(id){
    $('body').prepend('<div class="modal fade renameModal" id="fileRenameModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true"><div class="modal-dialog modal-dialog-centered" role="document"><div class="modal-content"><form action="server/files-server.php" method="get"><div class="modal-header"><h5 class="modal-title" id="exampleModalLongTitle">Rename File</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body"><div class="form-inline ml-auto" style="margin-top:0"><div class="md-form my-0"><input type="text" hidden name="id" value="'+id+'"><input type="text" hidden name="rename" value="true"><input  style="font-size:15px;opacity:70%;width:100%" name="name" class="form-control" type="text" placeholder="Enter File Name" aria-label="Search"></div></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button><input type="submit" data-toggle="tooltip" data-placement="bottom" title="Make New Folder" style="font-size:15px;opacity:70%" class="btn btn-outline-white btn-md my-0 ml-sm-2" value="Rename"></form></div></div></div>');
    $('.renameModal').modal();
    $('.renameModal').on('hidden', function () {
    $('.renameModal').remove();
    });
}
$("main").scroll(function(){
  $('#menuUl').hide();
});
</script><noscript> <div style="position: fixed; top: 0px; left: 0px; z-index: 3000; height: 100%; width: 100%; background-color: #FFFFFF"> <p style="margin-left: 10px">JavaScript is not enabled.</p> </div></noscript>
</div></div></div><script>$(document).ready(function() { $('body').bootstrapMaterialDesign(); });</script><div class="inner-fabs"><div class="fab round" id="fab4" data-tooltip="Text Editor"><a href="editor.php" style="color:#FFF"><i class="material-icons">code</i></a></div><div class="fab round" id="fab3" data-tooltip="Upload Files"><i class="material-icons"><a style="color:#FFF" data-toggle="modal" data-target="#uploadModal">backup</i></a></div></div><div style="z-index:99999" class="fab round" id="fab1"><i class="material-icons" id="fabIcon">add</i></div><style>a{text-decoration:none!important;}.round{border-radius:50%}.fab{-webkit-transition:all 300ms ease-in-out;transition:all 300ms ease-in-out;width:56px;height:56px;background-color:#0f9c8f;display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;position:fixed;right:12.5px;bottom:15px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;//cursor:pointer;color:#FFF;font-size:2em;box-shadow:0 3px 10px rgba(0,0,0,0.16),0px 3px 10px rgba(0,0,0,0.16)}.fab i{-webkit-transition:all 300ms ease-in-out;transition:all 300ms ease-in-out;will-change:transform}.inner-fabs .fab{width:40px;height:40px;right:20px;bottom:23px;font-size:1.5em;z-index:99999;will-change:bottom}.inner-fabs.show .fab:nth-child(1){bottom:80px}.inner-fabs.show .fab:nth-child(2){bottom:130px}.inner-fabs.show .fab:nth-child(3){bottom:180px}.inner-fabs.show .fab:nth-child(4){bottom:230px}.inner-fabs.show .fab:nth-child(5){bottom:280px}.inner-fabs.show .fab:nth-child(6){bottom:330px}.inner-fabs.show+.fab i{-webkit-transform:rotate(135deg);transform:rotate(135deg)}.fab:before{content:attr(data-tooltip);-webkit-transition:opacity 150ms cubic-bezier(0.4,0,1,1);transition:opacity 150ms cubic-bezier(0.4,0,1,1);position:absolute;visibility:hidden;opacity:0;box-shadow:0 1px 2px rgba(0,0,0,0.15);color:#ececec;right:50px;top:25%;background-color:rgba(70,70,70,0.9);font-size:.5em;line-height:1em;display:inline-block;text-align:center;white-space:nowrap;border-radius:2px;padding:6px 8px;max-width:200px;font-weight:bold;text-overflow:ellipsis;vertical-align:middle}.inner-fabs.show .fab:hover:before{content:attr(data-tooltip);visibility:visible;opacity:1}.demo-card__title{padding-left:1rem}</style><iframe class="d-none" name="delIframe"></iframe><iframe name="shareIframe" style="display: none"></iframe><iframe name="MakeFolderIframe" class="d-none"></iframe><link rel="manifest" href="server/manifests/manifest.json"><link rel="search" type="application/opensearchdescription+xml" title="Kabeer's Drive" href="server/search/search.xml"><script>if(localStorage.getItem("covidBanner") == null){$("covidBanner").html('<header class="optimize-covid-banner"> <h1 style=""> COVID-19 Update </h1> <p style=""> We\'re Working our very best to keep Drive&nbsp;up and running. <a href="#" style="">Learn more</a> <button aria-label="Close" onclick="this.parentElement.parentElement.style.display=\'none\'">×</button> </p></header>');localStorage.setItem("covidBanner","shown");}</script><!-- ADS  CASH ADS--><?php if($_SESSION['plus'] != 1){/*echo '<script data-cfasync="false" type="text/javascript" src="https://www.onclicksuper.com/a/display.php?r=3243199"></script>';*/}?><div  id="menuUl" class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div></main><?php if (isset($_GET['file'])){$locateId= strip_tags($_GET['file']);echo '<script>$("main div[data-id=\''.$locateId.'\']").addClass("ds-selected");var $container = $("main");var $scrollTo = $(".file[data-id=\''.$locateId.'\']");$container.animate({scrollTop: $scrollTo.offset().top - $container.offset().top + $container.scrollTop()-20, scrollLeft: 0},1000); window.history.replaceState({}, document.title, "/" );</script>';}?><script src="js/my-drive.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-145795163-3"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'UA-145795163-3');</script><script>$(document).on('contextmenu', function(e){$('#menuUl').css({left:e.pageX,top:e.pageY,display:'block'});});</script>